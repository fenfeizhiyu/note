##单机数据库

---

### 一 .redis主从服务器
  在redis中，可以通过slaveof命令或者设置slaveof选项，让一个服务器去复制另一个服务器。

#### 1.旧版复制功能实现
  分为同步和命令传播

  * 旧版同步:
    - 1.从服务器发送同步命令sync到主服务器
    - 2.主服务器执行Besave命令，在后台生成一个RDB文件，并使用一个缓冲记录后面收到的所有执行写命令
    - 3.主服务器的besave异步执行完成后，向从服务器发送RDB文件。
    - 4.从服务器接收完成，并加载RDB文件
    - 5.主服务器将缓冲的命令发送给从服务器，完成同步。
  缺陷:断线重连再复制时需要从头开始，效率比较低。
  * 新版同步

    - 1.使用psync命令来执行，具有完整同步和部分同步。
    - 2.在rdb文件同步完成后，如果连接断开重新连，从服务器会向主服务器发送自己的复制偏移量，主服务器根据复制偏移量来判断复制进度。并将丢失的命令再次发送给从服务器。
    - 3.主服务器维持一个复制积压缓冲区，是个固定长度的先进先出队列，用于断线重连的命令再发送。超过队列容量后，会触发完全同步，重新同步rdb文件。

### redis哨兵模式 sentinel

    sentinel是redis高可用方案的实现，自身由一个或多个sentinel实例构成，可以监视多个主服务器，及其下属从服务器，当有主服务器下线时，升级其下属从服务器为主服务器。
